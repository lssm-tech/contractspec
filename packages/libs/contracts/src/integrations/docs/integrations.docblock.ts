import type { DocBlock } from '@lssm/lib.contracts/docs';
import { registerDocBlocks } from '../../registry';

export const tech_contracts_integrations_DocBlocks: DocBlock[] = [
  {
    id: 'docs.tech.contracts.integrations',
    title: 'ContractSpec Integrations',
    summary:
      'This document describes the integration architecture that powers the',
    kind: 'reference',
    visibility: 'public',
    route: '/docs/tech/contracts/integrations',
    tags: ['tech', 'contracts', 'integrations'],
    body: '# ContractSpec Integrations\n\nThis document describes the integration architecture that powers the\nPocket Family Office vertical and other ContractSpec-based apps. It\nfocuses on provider-agnostic contracts, secret management, health\nchecking, and runtime guards.\n\n## Core Concepts\n\n- **IntegrationSpec** \u2013 declarative description of a provider that lists\n  supported ownership modes, capability mappings, configuration schema,\n  secret schema, health check policy, and documentation metadata.\n- **IntegrationConnection** \u2013 tenant/environment binding to a provider\n  (`meta` + ownership mode + config + `secretRef`). Secrets are never\n  embedded in specs or configs.\n- **AppIntegrationSlot** \u2013 blueprint-level requirement that declares\n  which integration categories/capabilities must be satisfied at runtime\n  (e.g. `primaryLLM`, `primaryVectorDb`).\n- **AppIntegrationBinding** \u2013 tenant-level slot \u2192 connection mapping.\n- **ResolvedIntegration** \u2013 runtime view containing slot metadata,\n  connection details, and the resolved IntegrationSpec.\n\n## Registered Providers\n\nThe Pocket Family Office reference registers ten priority providers in\n`packages/libs/contracts/src/integrations/providers`:\n\n| Category      | Provider         | Key                         | Notes                                             |\n| ------------- | ---------------- | --------------------------- | ------------------------------------------------- |\n| payments      | Stripe           | `payments.stripe`           | Card + invoice flows, managed or BYOK credentials |\n| email (out)   | Postmark         | `email.postmark`            | Transactional email delivery                      |\n| email (in)    | Gmail API        | `email.gmail`               | Thread ingestion (OAuth BYOK or service account)  |\n| calendar      | Google Calendar  | `calendar.google`           | Event scheduling via service account              |\n| vector-db     | Qdrant           | `vectordb.qdrant`           | Embedding storage & search                        |\n| storage       | Google Cloud     | `storage.gcs`               | S3-compatible object storage                      |\n| ai-llm        | Mistral          | `ai-llm.mistral`            | Primary chat + embedding provider                 |\n| ai-voice      | ElevenLabs       | `ai-voice.elevenlabs`       | Text-to-speech synthesis                          |\n| sms           | Twilio SMS       | `sms.twilio`                | Urgent and fallback reminders                     |\n| open-banking  | Powens           | `openbanking.powens`        | Read-only account, transaction, and balance sync  |\n\nEach provider ships with:\n\n- Strongly typed adapter interfaces (`payments.ts`, `llm.ts`, etc.).\n- A concrete SDK-backed implementation under `providers/impls`.\n- Unit tests validating adapter behaviour and health checks.\n\n## Secret Management\n\nAll integrations rely on the `SecretProvider` abstraction defined in\n`integrations/secrets`. Two providers ship with the contracts library and\nare orchestrated by the `SecretProviderManager` composite:\n\n- **EnvSecretProvider (`env-secret-provider.ts`)** \u2013 high-priority,\n  read-only overrides backed by environment variables. Supports the\n  `env://VARIABLE_NAME` scheme as well as overrides for other schemes via\n  `?env=ALIAS` or derived uppercase keys (e.g.\n  `gcp://.../stripe-secret-key` \u2192 `PROJECTS_DEMO_SECRETS_STRIPE_SECRET_KEY`).\n- **GcpSecretManagerProvider (`gcp-secret-manager.ts`)** \u2013 production\n  backend for versioned, auditable secrets stored in Google Cloud Secret\n  Manager.\n\nThe manager attempts providers in priority order (environment first,\nthen GCP). Key points:\n\n- `secretRef` uses a URI scheme (examples: `env://LOCAL_API_TOKEN`,\n  `gcp://projects/demo/secrets/stripe-key/versions/latest`).\n- `IntegrationCallGuard` fetches and parses secrets before executing a\n  provider adapter.\n- Providers never accept raw secrets in constructors; they expect a map\n  of resolved string values from the guard.\n- Local development can rely on `.env` files, while staging/production\n  reference long-lived GCP secrets without changing the integration\n  specs.\n\n## Health Checks & Telemetry\n\n- Each IntegrationSpec optionally declares `healthCheck.method` and\n  timeouts.\n- `IntegrationCallGuard` enforces connection status, wraps retries with\n  exponential back-off, and emits telemetry events tagged with tenant,\n  app, blueprint, config version, and slot id.\n- Validation rules (`app-config/validation.ts`) surface issues at\n  publish time (slot mismatch, unsupported ownership modes, missing\n  capabilities, etc.).\n\n## Runtime Usage\n\n1. Blueprint defines slots (`primaryLLM`, `primaryVectorDb`, ...).\n2. Tenant binds connections referencing the integration ids above.\n3. `composeAppConfig` merges blueprint + tenant, resolving specs,\n   connections, and knowledge bindings.\n4. Workflow runner fetches providers via `IntegrationCallGuard` and\n   executes operations with full guardrails.\n\nSee `packages/verticals/pocket-family-office` for\nexamples of how the blueprint, tenant config, and workflows pull these\npieces together.\n\n\n\n',
  },
];
registerDocBlocks(tech_contracts_integrations_DocBlocks);
